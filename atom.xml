<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://Busy-Bob.github.io</id>
    <title>å‹ºæµ·çš„åšå®¢</title>
    <updated>2020-11-24T02:10:30.666Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://Busy-Bob.github.io"/>
    <link rel="self" href="https://Busy-Bob.github.io/atom.xml"/>
    <subtitle>å°½åº”å°½ä¹‹äº‹ï¼Œåšè®©è‡ªå·±å¼€å¿ƒçš„äº‹ã€‚</subtitle>
    <logo>https://Busy-Bob.github.io/images/avatar.png</logo>
    <icon>https://Busy-Bob.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, å‹ºæµ·çš„åšå®¢</rights>
    <entry>
        <title type="html"><![CDATA[Rust const æ³›å‹ (Const Generics)çš„ä½¿ç”¨æ–¹æ³•ï¼šè§£æconst_unit_poc]]></title>
        <id>https://Busy-Bob.github.io/post/rust-const-fan-xing-const-genericsde-shi-yong-fang-fa-jie-xi-const_unit_poc_/</id>
        <link href="https://Busy-Bob.github.io/post/rust-const-fan-xing-const-genericsde-shi-yong-fang-fa-jie-xi-const_unit_poc_/">
        </link>
        <updated>2020-11-23T12:15:59.000Z</updated>
        <summary type="html"><![CDATA[<p>å¯¹äºconst æ³›å‹ï¼Œç¬”è€…ä¹Ÿäº†è§£ç”šå°‘ã€‚å€Ÿå†™è¯¥æ–‡ç« çš„æœºä¼šï¼Œå­¦ä¹ ä¸€ä¸‹Rustçš„const æ³›å‹(Const Generics)</p>
]]></summary>
        <content type="html"><![CDATA[<p>å¯¹äºconst æ³›å‹ï¼Œç¬”è€…ä¹Ÿäº†è§£ç”šå°‘ã€‚å€Ÿå†™è¯¥æ–‡ç« çš„æœºä¼šï¼Œå­¦ä¹ ä¸€ä¸‹Rustçš„const æ³›å‹(Const Generics)</p>
<!-- more -->
<h2 id="const_unit_poc-åˆ©ç”¨const-genericså®ç°çš„ç‰©ç†å•ä½åº“"><code>const_unit_poc</code> ï¼šåˆ©ç”¨const genericså®ç°çš„ç‰©ç†å•ä½åº“</h2>
<p><code>const_unit_poc</code>  æ˜¯å‡ å¤©å‰æ¨å‡ºçš„ï¼Œç‡å…ˆä½¿ç”¨const æ³›å‹çš„åº“ã€‚è¯¥åº“çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-rust">#![feature(const_generics, const_evaluatable_checked)]
use const_unit_poc::values::{m, kg, s, N};

let distance = 1.0 * m;
let mass = 18.0 * kg;
let force = distance * mass / (1.8 * s * 2.0 * s);
assert_eq!(force, 5.0 * N);

let mut mutable_distance = 3.2 * m;
mutable_distance -= 0.2 * m;
mutable_distance += 2.0 * m;

assert_eq!(mutable_distance, 5.0 * m);
</code></pre>
<p>ä»£ç åŠå…¶ç®€ä¾¿ï¼æ˜“æ‡‚ï¼éå¸¸ç¥å¥‡ï¼æ‰€ä»¥å°±æ ¹æ®è¯¥åº“çš„æºä»£ç çœ‹çœ‹const æ³›å‹è¯¥å¦‚ä½•ä½¿ç”¨ã€‚</p>
<h2 id="const_unit_poc-æºç åˆ†æ"><code>const_unit_poc</code> æºç åˆ†æ</h2>
<p><a href="https://docs.rs/crate/const_unit_poc/1.0.0/source/src/lib.rs"><code>./src/lib.rs</code></a>ï¼š</p>
<pre><code class="language-rust">#![feature(const_generics, const_evaluatable_checked, doc_cfg)]
#![allow(incomplete_features)]
#![cfg_attr(feature = &quot;non_ascii&quot;, feature(non_ascii_idents))]

use std::ops;

pub mod units;
pub mod values;

#[derive(Copy, Clone, Debug, PartialEq, Eq)]
#[allow(non_snake_case)]
pub struct SiUnit {
    m: i8,
    kg: i8,
    s: i8,
    A: i8,
    K: i8,
    mol: i8,
    cd: i8,
}

// åé¢è¿˜æœ‰å†…å®¹
</code></pre>
<p>è¿™é‡Œå¼•å…¥äº†<code>units</code>, <code>values</code>ä¸¤ä¸ªmodï¼Œå¹¶ä¸”å£°æ˜äº†<code>SiUnit</code> è¿™ä¸ªç»“æ„ä½“ï¼Œé‡Œé¢çš„æˆå‘˜æ˜¯SIçš„7ä¸ªæ ‡å‡†å•ä½ï¼Œ ç±»å‹ä¸ºi8ã€‚</p>
<p>çœ‹åˆ°è¿™å„¿ï¼Œç¬”è€…æ¨æµ‹åº”è¯¥æ˜¯ä½¿ç”¨ <code>SiUnit</code> è¿™ä¸ªç»“æ„ä½“æ¥å®ä¾‹åŒ–å„ç§å¸¸ç”¨çš„å•ä½ï¼ˆå¦‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span>ï¼‰ï¼Œå…¶ä¸­æˆå‘˜çš„å€¼è¡¨ç¤ºè¯¥å•ä½è¡¨ç¤ºæˆåŸºæœ¬å•ä½åçš„æŒ‡æ•°çš„å€¼ï¼ˆå¦‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mo>=</mo><mi>m</mi><mo>âˆ—</mo><msup><mi>s</mi><mrow><mo>âˆ’</mo><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">N=m*s^{-2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.46528em;vertical-align:0em;"></span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>ï¼Œ åˆ™<code>N.m == 1; N.s == -2</code>ï¼‰ã€‚</p>
<p>å†çœ‹ä¸€ä¸‹å¼•å…¥çš„æ¨¡å—<code>units</code>çš„å†…å®¹</p>
<h3 id="unitsçš„å®ç°">unitsçš„å®ç°</h3>
<p><a href="https://docs.rs/crate/const_unit_poc/1.0.0/source/src/units.rs"><code>./src/units.rs</code></a>ï¼š</p>
<pre><code class="language-rust">#![allow(non_upper_case_globals)]
use super::SiUnit;
const NONE: SiUnit = SiUnit { m: 0, kg: 0, s: 0, A: 0, K: 0, mol: 0, cd: 0 };
/// meter
pub const m: SiUnit = SiUnit { m: 1, ..NONE };
/// ä¸­é—´å†…å®¹çœç•¥
/// lux
pub const lx: SiUnit = SiUnit { m: -2, cd: 1, ..NONE };
/// square meter
pub const sq_m: SiUnit = SiUnit { m: 2, ..NONE };
/// cubic meter
pub const cu_m: SiUnit = SiUnit { m: 3, ..NONE };
</code></pre>
<p>çš„ç¡®å’ŒçŒœæƒ³ä¸€è‡´ï¼æ³¨æ„ç»“æ„ä½“å®ä¾‹åŒ–æ—¶å€™è¿™å„¿ä½¿ç”¨äº†<code>..NONE</code>ï¼Œè¿™æ˜¯ç”¨å·²ç»åˆ›å»ºçš„å®ä¾‹Noneä¸Š<strong>æ›´æ–°éƒ¨åˆ†å‚æ•°</strong>ï¼Œåˆ›å»ºæ–°çš„å®ä¾‹ï¼Œè§<a href="https://kaisery.github.io/trpl-zh-cn/ch05-01-defining-structs.html#%E4%BD%BF%E7%94%A8%E7%BB%93%E6%9E%84%E4%BD%93%E6%9B%B4%E6%96%B0%E8%AF%AD%E6%B3%95%E4%BB%8E%E5%85%B6%E4%BB%96%E5%AE%9E%E4%BE%8B%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B">ä½¿ç”¨ç»“æ„ä½“æ›´æ–°è¯­æ³•ä»å…¶ä»–å®ä¾‹åˆ›å»ºå®ä¾‹</a>ã€‚è¿™å„¿ä½¿ç”¨äº†constä½¿å¾—å„ä¸ªå•ä½å…¨å±€å¯è§ä¸”ä¸å¯å˜ã€‚</p>
<p>ç°åœ¨å·²ç»æœ‰äº†å•ä½ï¼Œä½†æ˜¯æˆ‘ä»¬æ³¨æ„åˆ°ä»£ç ä¸­<code>assert_eq!(mutable_distance, 5.0 * m);</code>ä¸ä»…ä»…è¦æ£€æµ‹å•ä½çš„å€¼ï¼Œè¿˜è¦æ£€æµ‹ç³»æ•°çš„å€¼ï¼Œç»“æ„ä½“ä¸æ•°å­—ç›¸ä¹˜ååˆè¯¥å¦‚ä½•è¡¨ç¤ºå‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜åº”è¯¥èƒ½å¤Ÿä»å¦ä¸€ä¸ªæ¨¡å—å¾—åˆ°ç­”æ¡ˆå§ã€‚</p>
<h3 id="å¯¹å•ä½ç³»æ•°çš„åŒ…è£…">å¯¹å•ä½ç³»æ•°çš„åŒ…è£…</h3>
<p><a href="https://docs.rs/crate/const_unit_poc/1.0.0/source/src/values.rs"><code>./src/values.rs</code></a>ï¼š</p>
<pre><code class="language-rust">#![allow(non_upper_case_globals)]
use crate::{units, Quantity};
// base
/// 1 meter
pub const m: Quantity&lt;{ units::m }&gt; = Quantity { raw_value: 1.0 };
/// 1 kilogram
pub const kg: Quantity&lt;{ units::kg }&gt; = Quantity { raw_value: 1.0 };
/// 1 second
pub const s: Quantity&lt;{ units::s }&gt; = Quantity { raw_value: 1.0 };
/// åé¢è¿˜æœ‰
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼š<code>use crate::{units, Quantity}</code>, ä»£è¡¨çš„æ˜¯å¯¼å…¥çš„å½“å‰<code>crate</code>ä¸­çš„<code>units</code>å’Œ<code>Quantity</code>ã€‚<br>
<strong>const æ³›å‹</strong>: ä»è¿™å„¿çš„å¯ä»¥å¤§æ¦‚å¯ä»¥çœ‹å‡ºï¼Œ<code>Quantity</code>çš„æ³›å‹å‚æ•°æ˜¯ä¸€ä¸ªconstå¸¸é‡ï¼ŒåŒ…è£…æ¯ä¸€ä¸ª<code>units.rs</code>ä¸­çš„constå¸¸é‡å€¼ã€‚è¿™å°±æ˜¯const genericså§! åé¢çš„å®ä¾‹åŒ–æ ¹æ®ç±»å‹æ¨å¯¼åº”è¯¥åˆå¯ä»¥å†™åšï¼š<code>Quantity&lt;{ units::m }&gt; { raw_value: 1.0 }</code>ã€‚ æ‰€ä»¥æ˜¯ç”¨<code>raw_value</code>æ¥è¡¨ç¤ºæ¯ä¸€ä¸ªå•ä½çš„ç³»æ•°ã€‚</p>
<p>æ‰€ä»¥å†æ¥çœ‹çœ‹<code>Quantity</code>çš„å®šä¹‰å§ã€‚</p>
<p>###ç»“æ„ä½“ <code>Quantity</code>çš„å®šä¹‰</p>
<p><a href="https://docs.rs/crate/const_unit_poc/1.0.0/source/src/lib.rs"><code>./src/lib.rs</code></a>ï¼š</p>
<pre><code class="language-rust">#[derive(Copy, Clone, Debug, PartialEq, PartialOrd)]
#[repr(transparent)]
pub struct Quantity&lt;const U: SiUnit&gt; {
    pub raw_value: f64,
}
</code></pre>
<p>ç®€å•å¹²è„†çš„ä½¿ç”¨const ç±»å‹ä½œä¸ºæ³›å‹å‚æ•°ã€‚</p>
<h3 id="åŠ å‡è¿ç®—">åŠ å‡è¿ç®—</h3>
<p><a href="https://docs.rs/crate/const_unit_poc/1.0.0/source/src/lib.rs"><code>./src/lib.rs</code></a>ï¼š</p>
<pre><code class="language-rust">impl&lt;const U: SiUnit&gt; ops::Add for Quantity&lt;U&gt; {
    type Output = Self;

    fn add(self, rhs: Self) -&gt; Self {
        Self { raw_value: self.raw_value + rhs.raw_value }
    }
}

impl&lt;const U: SiUnit&gt; ops::AddAssign for Quantity&lt;U&gt; {
    fn add_assign(&amp;mut self, rhs: Self) {
        self.raw_value += rhs.raw_value;
    }
}

impl&lt;const U: SiUnit&gt; ops::Sub for Quantity&lt;U&gt; {
    type Output = Self;

    fn sub(self, rhs: Self) -&gt; Self {
        Self { raw_value: self.raw_value - rhs.raw_value }
    }
}

impl&lt;const U: SiUnit&gt; ops::SubAssign for Quantity&lt;U&gt; {
    fn sub_assign(&amp;mut self, rhs: Self) {
        self.raw_value -= rhs.raw_value;
    }
}
</code></pre>
<p>ç”±äºåŠ å‡è¿ç®—å¹¶ä¸ä¼šå˜å•ä½ï¼Œæ‰€ä»¥å°±æ˜¯å¯¹ç³»æ•°çš„åŠ å‡ï¼Œéå¸¸ç›´æ¥ã€‚</p>
<h3 id="ä¹˜é™¤è¿ç®—">ä¹˜é™¤è¿ç®—</h3>
<ul>
<li>ä¸€ä¸ªæ•°å­—ä¸ä¸€ä¸ªQuantityç›¸ä¹˜ï¼Œå•ä½ä¸å˜ï¼š</li>
</ul>
<p><a href="https://docs.rs/crate/const_unit_poc/1.0.0/source/src/lib.rs"><code>./src/lib.rs</code></a>ï¼š</p>
<pre><code class="language-rust">impl&lt;const U: SiUnit&gt; ops::Mul&lt;f64&gt; for Quantity&lt;U&gt; {
    type Output = Quantity&lt;U&gt;;

    fn mul(self, rhs: f64) -&gt; Self::Output {
        Quantity { raw_value: self.raw_value * rhs }
    }
}
</code></pre>
<ul>
<li>ä¸¤ä¸ªå¸¦å•ä½çš„é‡ç›¸ä¹˜ï¼Œå•ä½å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿå°±æ˜¯<code>Quantity&lt;U&gt;</code>çš„æ³›å‹å‚æ•°å‘ç”Ÿäº†å˜åŒ–ï¼Œæ­¤æ—¶éœ€è¦é‡æ–°å®ä¾‹åŒ–ä¸€ä¸ª<code>Quantity&lt;U&gt;</code>ç»“æ„ä½“ï¼š</li>
</ul>
<p><a href="https://docs.rs/crate/const_unit_poc/1.0.0/source/src/lib.rs"><code>./src/lib.rs</code></a>ï¼š</p>
<pre><code class="language-rust">// Quantityç›¸ä¹˜è½¬æ¢ä¸ºunitç›¸ä¹˜ï¼ŒUL.unit_mul(UR)
impl&lt;const UL: SiUnit, const UR: SiUnit&gt; ops::Mul&lt;Quantity&lt;UR&gt;&gt; for Quantity&lt;UL&gt;
where
    Quantity&lt;{ UL.unit_mul(UR) }&gt;: ,
{
    type Output = Quantity&lt;{ UL.unit_mul(UR) }&gt;;

    fn mul(self, rhs: Quantity&lt;UR&gt;) -&gt; Self::Output {
        Quantity { raw_value: self.raw_value * rhs.raw_value }
    }
}
// unitç›¸ä¹˜
impl SiUnit {
    const fn unit_mul(self, rhs: Self) -&gt; Self {
        Self {
            m: self.m + rhs.m,
            kg: self.kg + rhs.kg,
            s: self.s + rhs.s,
            A: self.A + rhs.A,
            K: self.K + rhs.K,
            mol: self.mol + rhs.mol,
            cd: self.cd + rhs.cd,
        }
    }
}
</code></pre>
<ul>
<li>è¿™å„¿å¯¹æ³›å‹çš„çº¦æŸå¾ˆç¥å¥‡ï¼Œç«Ÿç„¶æ˜¯è¿™æ ·å†™<code>Quantity&lt;{ UL.unit_mul(UR) }&gt;:</code> ï¼Œå¦‚æœå»æ‰è¿™ä¸ªwhereï¼Œåˆ™ä¼šæŠ¥é”™unconstrained generic constantã€‚è™½ç„¶ç°åœ¨è¿˜ä¸æ‡‚æ˜¯ä»€ä¹ˆæ„æ€....</li>
</ul>
<pre><code>error: unconstrained generic constant
   --&gt; src\lib.rs:156:5
    |
156 |     type Output = Quantity&lt;{ UL.unit_mul(UR) }&gt;;     
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^     
    |
help: consider adding a `where` bound for this expression  
   --&gt; src\lib.rs:156:28
    |
156 |     type Output = Quantity&lt;{ UL.unit_mul(UR) }&gt;;     
    |                            ^^^^^^^^^^^^^^^^^^^     
</code></pre>
<ul>
<li>å¦å¤–ä¸€ç‚¹ï¼Œæ³›å‹ä¸­çš„constæ˜¯è°ƒç”¨ä¸€ä¸ªconst fnå¾—åˆ°çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ‰“å¤§æ‹¬å·ï¼Œå¦‚ï¼š<code>Quantity&lt;{ UL.unit_mul(UR) }&gt;</code> ï¼Œå¦åˆ™ä¹Ÿä¼šå‡ºé”™ã€‚è¿™åœ¨æœ€è¿‘çš„<a href="https://github.com/rust-lang/rust/pull/79135">Stabilization report</a>é‡Œé¢ä¹Ÿæœ‰æåˆ°ã€‚</li>
</ul>
<blockquote>
<h2 id="const-arguments">Const arguments</h2>
<p>Const parameters are instantiated using const arguments. Any concrete const expression or const parameter as a standalone argument can be used. When applying an expression as const parameter, <strong>most expressions must be contained within a block</strong>, with two exceptions:</p>
<ol>
<li>literals and single-segment path expressions</li>
<li>array lengths</li>
</ol>
<p>This syntactic restriction is necessary to avoid ambiguity, or requiring infinite lookahead when parsing an expression as a generic argument.</p>
<p>In the cases where a generic argument could be resolved as either a type or const argument, we always interpret it as a type. This causes the following test to fail:</p>
<pre><code class="language-rust">type N = u32;
struct Foo&lt;const N: usize&gt;;
fn foo&lt;const N: usize&gt;() -&gt; Foo&lt;N&gt; { todo!() } // ERR
</code></pre>
<p>To circumvent this, the user may wrap the const parameter with braces, at which point it is unambiguously accepted.</p>
<pre><code class="language-rust">type N = u32;
struct Foo&lt;const N: usize&gt;;
fn bar&lt;const N: usize&gt;() -&gt; Foo&lt;{ N }&gt; { todo!() } // ok
</code></pre>
</blockquote>
<p>ç®€å•æ¥è¯´ï¼Œconst æ³›å‹ä¸€èˆ¬éƒ½éœ€è¦æ‰“å¤§æ‹¬å·(ä¸¤ç§æƒ…å†µé™¤å¤–)ï¼Œæ‰“å¤§æ‹¬å·æ˜¯ä¸ºäº†é˜²æ­¢æ­§ä¹‰ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯äº†è§£äº†const æ³›å‹åœ¨åšå•¥ï¼Œä»¥åŠå¦‚ä½•åšçš„ã€‚</p>
<p>é€šè¿‡è¿™ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘æ„Ÿè§‰const æ³›å‹æ˜¯ç”¨åœ¨å½“æ³›å‹éœ€è¦æœ‰å–å€¼çš„æ—¶å€™ï¼ˆæ¯”å¦‚è¿™é‡Œçš„unitå°±éœ€è¦å–å€¼ï¼Œè€Œä¸èƒ½æ¯ä¸€ä¸ªå•ä½ä¸€ä¸ªç±»å‹...ï¼‰ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ Rust å¼‚æ­¥å¹¶å‘ï¼ˆä¸€ï¼‰]]></title>
        <id>https://Busy-Bob.github.io/post/rust-yi-bu/</id>
        <link href="https://Busy-Bob.github.io/post/rust-yi-bu/">
        </link>
        <updated>2020-11-22T15:07:53.000Z</updated>
        <summary type="html"><![CDATA[<p>å‰ä¸€æ®µæ—¶é—´çœ‹äº†ä¸€äº›å…³äºRustçš„å¼‚æ­¥ç¼–ç¨‹ç›¸å…³çš„çŸ¥è¯†ï¼Œå—ç›ŠåŒªæµ…ï¼Œæ•…åšæ­¤è®°å½•ã€‚<br>
Rustå¼‚æ­¥ç¼–ç¨‹æ˜¯Rustè¯­è¨€ä¸­ååˆ†é‡è¦ç‰¹æ€§ã€‚ç°åœ¨Rustä¸­çš„å¼‚æ­¥ç¼–ç¨‹é‡‡ç”¨<code>async/.await</code>è§£å†³æ–¹æ¡ˆã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å‰ä¸€æ®µæ—¶é—´çœ‹äº†ä¸€äº›å…³äºRustçš„å¼‚æ­¥ç¼–ç¨‹ç›¸å…³çš„çŸ¥è¯†ï¼Œå—ç›ŠåŒªæµ…ï¼Œæ•…åšæ­¤è®°å½•ã€‚<br>
Rustå¼‚æ­¥ç¼–ç¨‹æ˜¯Rustè¯­è¨€ä¸­ååˆ†é‡è¦ç‰¹æ€§ã€‚ç°åœ¨Rustä¸­çš„å¼‚æ­¥ç¼–ç¨‹é‡‡ç”¨<code>async/.await</code>è§£å†³æ–¹æ¡ˆã€‚</p>
<!-- more -->
<h1 id="1-ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ç¼–ç¨‹">1. ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ç¼–ç¨‹ï¼Ÿ</h1>
<p>åˆšå¼€å§‹ä¸€ç›´æœ‰ä¸€ä¸ªç–‘é—®ï¼š<strong>æ—¢ç„¶å·²ç»æœ‰äº†å¤šçº¿ç¨‹æŠ€æœ¯ï¼Œå¤šç”¨æˆ·è®¿é—®ç›´æ¥ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å¼‚æ­¥å‘¢ï¼Ÿ</strong> åæ¥ç»ˆäºæ˜ç™½ï¼Œå¼‚æ­¥æ˜¯ç”¨åœ¨å¤šç”¨æˆ·<strong>åŒæ—¶å¤„ç†åŒä¸€èµ„æº</strong>æ—¶å€™å‘æŒ¥ä½œç”¨çš„ã€‚</p>
<pre><code>ç°åœ¨ç”¨100ä¸ªç”¨æˆ·åŒæ—¶ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶æ¥ä¸¾ä¾‹ï¼š
</code></pre>
<ul>
<li>
<p><strong>åŒæ­¥</strong>(ä¸€èˆ¬ä¹Ÿæ˜¯<strong>é˜»å¡</strong>)ï¼š ç¨‹åºéœ€è¦å®ç°<strong>è¯»å†™é”(<code>std::sync::RwLock</code>)<strong>æˆ–</strong>äº’æ–¥é”(<code>std::sync::Mutex</code>)</strong>ï¼Œç¨‹åºä¼šåŒæ—¶äº§ç”Ÿ100ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰å†™é”ï¼Œå…¶ä»–çš„99ä¸ªçº¿ç¨‹å‡</p>
<ul>
<li>å¤„äº<strong>ç­‰å¾…çŠ¶æ€</strong>ï¼Œçº¿ç¨‹ä¸ä¼šsleepï¼Œä¼šå¾ªç¯è·å–é”(è‡ªæ—‹é”Spinlock)ã€‚
<ul>
<li>é˜»å¡çš„çº¿ç¨‹è¿˜æ¥å‚ä¸æ“ä½œç³»ç»Ÿçš„æŠ¢å å¼è°ƒåº¦ï¼Œå¾ˆä¸ç§‘å­¦ï¼ä¸ºä»€ä¹ˆä¸å…ˆæ’å¥½é˜Ÿï¼Œç”¨ä¸€ä¸ªçº¿ç¨‹å‘¢ï¼ˆè¿™ä¹Ÿæ˜¯åç¨‹å¹²çš„äº‹ï¼‰</li>
</ul>
</li>
<li>æˆ–è€…æœ‰èµ·å§‹çš„<strong>åŠ é”å¼€é”€</strong>(é€šå¸¸æ˜¯å¯¹äº’æ–¥é”ï¼šâ‘ çº¿ç¨‹ä¼šä»sleepï¼ˆåŠ é”ï¼‰â€”â€”&gt;runningï¼ˆè§£é”ï¼‰ï¼Œè¿‡ç¨‹ä¸­æœ‰ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ï¼Œcpuçš„æŠ¢å ï¼Œä¿¡å·çš„å‘é€ç­‰å¼€é”€ï¼›â‘¡äº’æ–¥é”åœ¨sleepæ—¶ä¼šé™·å…¥åˆ°å†…æ ¸æ€ï¼Œéœ€è¦æ˜‚è´µçš„ç³»ç»Ÿè°ƒç”¨ï¼›çº¿ç¨‹å‘æ“ä½œç³»ç»Ÿè¯·æ±‚è¢«æŒ‚èµ·æ˜¯é€šè¿‡ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨linuxä¸Šçš„å®ç°å°±æ˜¯futex)ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¼‚æ­¥</strong>(ä¸€èˆ¬ä¹Ÿæ˜¯<strong>éé˜»å¡</strong>)ï¼š å°†100ä¸ªçº¿ç¨‹æ ¹æ®ä¸€å®šçš„å…ˆåæ¬¡åº<strong>åˆå¹¶æˆä¸€ä¸ªçº¿ç¨‹</strong>(ä¹Ÿå¯èƒ½æ˜¯å¤šä¸ªçº¿ç¨‹ï¼Ÿ)ï¼Œ å°±å¯ä»¥é¿å…é”çš„äº§ç”Ÿï¼Œä»è€Œå‡å°‘æ“ä½œç³»ç»Ÿå¯¹çº¿ç¨‹è°ƒç”¨çš„å¼€é”€ã€‚ä½†æ˜¯ï¼Œå½“çº¿ç¨‹ä¹‹é—´å¯¹èµ„æºçš„ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚çš„æ—¶å€™ï¼Œç¨‹åºçš„ç¼–å†™å°±ä¼š<strong>ååˆ†å¤æ‚</strong>ã€‚</p>
<ul>
<li><strong>åç¨‹</strong>(coroutine)ï¼š å®ç°å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§æ–¹å¼ï¼Œæ˜¯åœ¨çº¿ç¨‹ä¹‹ä¸‹çš„ä¸€ä¸ªå•ä½ã€‚åç¨‹æ˜¯è¯­è¨€å±‚é¢æ§åˆ¶æ•°æ®æµçš„ä¸€ç§â€œè°ƒåº¦â€ï¼ˆå¤„ç†å…¬å…±èµ„æºçš„æ—¶å€™ï¼Œç›¸å½“äº<strong>ç”¨æˆ·æ€çš„é”</strong>ï¼‰ï¼Œ çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿå±‚é¢çš„â€œè°ƒåº¦â€ï¼ˆå¤„ç†å…¬å…±èµ„æºï¼Œä½¿ç”¨<strong>æ“ä½œç³»ç»Ÿæˆ–è€…ç¡¬ä»¶çš„é”(å³Mutexæˆ–è€…Spinlock)</strong>ï¼‰ã€‚åç¨‹çš„è°ƒåº¦æ˜¯ç¼–è¯‘å™¨é€šè¿‡ç»„ç»‡è¿ç®—é¡ºåºå®ç°çš„ï¼ˆé€šè¿‡ç”Ÿæˆå™¨ï¼ˆç­‰åŒäºä¸€ä¸ªçŠ¶æ€æœºï¼‰å®ç°ï¼‰ï¼Œçº¿ç¨‹æ˜¯é€šè¿‡æ“ä½œç³»ç»Ÿæ¥è¿›è¡ŒæŠ¢å å¼è°ƒåº¦çš„ã€‚</li>
<li><a href="https://zh.wikipedia.org/wiki/%E5%8D%8F%E7%A8%8B">åç¨‹wiki</a>ï¼šåç¨‹éå¸¸ç±»ä¼¼äºçº¿ç¨‹ã€‚ä½†æ˜¯åç¨‹æ˜¯åä½œå¼å¤šä»»åŠ¡çš„ï¼Œè€Œçº¿ç¨‹å…¸å‹æ˜¯æŠ¢å å¼å¤šä»»åŠ¡çš„ã€‚è¿™æ„å‘³ç€åç¨‹æä¾›å¹¶å‘æ€§è€Œéå¹¶è¡Œæ€§ã€‚åç¨‹è¶…è¿‡çº¿ç¨‹çš„å¥½å¤„æ˜¯å®ƒä»¬å¯ä»¥ç”¨äºç¡¬æ€§å®æ—¶çš„è¯­å¢ƒï¼ˆåœ¨åç¨‹ä¹‹é—´çš„åˆ‡æ¢ä¸éœ€è¦æ¶‰åŠä»»ä½•ç³»ç»Ÿè°ƒç”¨æˆ–ä»»ä½•é˜»å¡è°ƒç”¨ï¼‰ï¼Œè¿™é‡Œä¸éœ€è¦ç”¨æ¥å®ˆå«å…³é”®åŒºå—çš„åŒæ­¥æ€§åŸè¯­ï¼ˆprimitiveï¼‰æ¯”å¦‚äº’æ–¥é”ã€ä¿¡å·é‡ç­‰ï¼Œå¹¶ä¸”ä¸éœ€è¦æ¥è‡ªæ“ä½œç³»ç»Ÿçš„æ”¯æŒã€‚</li>
<li><a href="https://www.zhihu.com/question/332113890/answer/1052024052">äº’æ–¥é”ï¼ˆmutexï¼‰çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="https://www.zhihu.com/question/50185085/answer/1342613525">å‡ºäºä»€ä¹ˆæ ·çš„åŸå› ï¼Œè¯ç”Ÿäº†ã€Œåç¨‹ã€è¿™ä¸€æ¦‚å¿µï¼Ÿ</a></li>
</ul>
</li>
</ul>
<p>æ‰€ä»¥ï¼Œå¼‚æ­¥ç¼–ç¨‹æ˜¯å¯ä»¥ç›´æ¥ç”¨å¤æ‚çš„ä»£ç ç»“æ„ç›´æ¥å†™å‡ºæ¥çš„ã€‚æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­å°±æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œé¢å»ä¾æ¬¡è¯»å†™100æ¬¡ã€‚è€ŒRustçš„<code>async/.await</code>è§£å†³æ–¹æ¡ˆåšçš„å·¥ä½œæ˜¯ <strong>â€œå°†å¤æ‚çš„å¼‚æ­¥ä»£ç  ===&gt; åˆ©ç”¨è¯­æ³•ç³– ===&gt; è½¬åŒ–ä¸ºç±»ä¼¼äºåŒæ­¥çš„ä»£ç (æ›´å®¹æ˜“coding)â€</strong>  å³ <strong>â€œç”¨åŒæ­¥çš„è¯­ä¹‰è§£å†³å¼‚æ­¥é—®é¢˜â€</strong> ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[2020.11.22 ä¼Šå§‹]]></title>
        <id>https://Busy-Bob.github.io/post/2020112-yi-shi/</id>
        <link href="https://Busy-Bob.github.io/post/2020112-yi-shi/">
        </link>
        <updated>2020-11-22T08:45:04.000Z</updated>
        <content type="html"><![CDATA[<p>ä»<strong>ä»Šå¤©</strong>å¼€å§‹è®°å½•å­¦ä¹ å’Œç”Ÿæ´»ã€‚</p>
<p>æˆ‘ä¹Ÿæ˜¯ä¸€ä¸ªæ‡’æƒ°çš„å°åšä¸»å•¦~ğŸ˜‹</p>
]]></content>
    </entry>
</feed>